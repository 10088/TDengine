system sh/stop_dnodes.sh

system sh/deploy.sh -n dnode1 -i 1
system sh/cfg.sh -n dnode1 -c walLevel -v 1
system sh/exec.sh -n dnode1 -s start
sleep 500
sql connect

$dbPrefix = db
$tbPrefix = ct
$mtPrefix = st
$quote = '
$tbNum = 2
$rowNum = 50

print =============== step1 create stable/table
$i = 0
$db = $dbPrefix . $i
$mt = $mtPrefix . $i

sql drop database $db -x step1
step1:
sql create database $db
sql use $db
sql create table $mt (ts timestamp, c1 int, c2 binary(10), c3 binary(30), c4 binary(40), c5 binary(50), c6 nchar(10), c7 nchar(20), c8 nchar(30), c9 nchar(40)) TAGS (tgcol int)
$i = 0
while $i < $tbNum
  $tb = $tbPrefix . $i
  sql create table $tb using $mt tags( $i )

  $x = 0

  $z2 = $x . 2 
  $y2 = $quote . $z2 
  $y2 = $y2 . $quote

  $z3 = $x . 3 
  $y3 = $quote . $z3 
  $y3 = $y3 . $quote

  $z4 = $x . 4 
  $y4 = $quote . $z4
  $y4 = $y4 . $quote

  $z5 = $x . 5 
  $y5 = $quote . $z5
  $y5 = $y5 . $quote

  $z6 = $x . 6 
  $y6 = $quote . $z6
  $y6 = $y6 . $quote

  $z7 = $x . 7 
  $y7 = $quote . $z7
  $y7 = $y7 . $quote

  $z8 = $x . 8 
  $y8 = $quote . $z8
  $y8 = $y8 . $quote

  $z9 = $x . 9 
  $y9 = $quote . $z9
  $y9 = $y9 . $quote

  while $x < $rowNum
    $cc = $x * 60000
    $ms = 1601481600000 + $cc
    
    sql insert into $tb values ($ms , $x , $y2 , $y3 , $y4 , $y5 , $y6 , $y7 , $y8 , $y9 )
    $x = $x + 1
					$z2 = $x . 2 
					$y2 = $quote . $z2 
					$y2 = $y2 . $quote

					$z3 = $x . 3 
					$y3 = $quote . $z3 
					$y3 = $y3 . $quote

					$z4 = $x . 4 
					$y4 = $quote . $z4
					$y4 = $y4 . $quote

					$z5 = $x . 5 
					$y5 = $quote . $z5
					$y5 = $y5 . $quote

					$z6 = $x . 6 
					$y6 = $quote . $z6
					$y6 = $y6 . $quote

					$z7 = $x . 7 
					$y7 = $quote . $z7
					$y7 = $y7 . $quote

					$z8 = $x . 8 
					$y8 = $quote . $z8
					$y8 = $y8 . $quote

					$z9 = $x . 9 
					$y9 = $quote . $z9
					$y9 = $y9 . $quote
  endw

  $i = $i + 1
endw

print ================= step2
$i = 1
$tb = $tbPrefix . $i
$stb = $mtPrefix . 0

print sql select concat(c2, c3, c4, c5) from $tb
sql select concat(c2, c3, c4, c5) from $tb
print $data00
if $data00 != 02030405 then
  return -1
endi

print sql select concat_ws('data',c2,c3,c4,c5) from $tb
sql select concat_ws('data',c2,c3,c4,c5) from $tb
print $data00

if $data00 != 02data03data04data05 then
  return -1
endi
print sql select concat(c6, c7, c8, c9) from $tb
sql select concat(c6, c7, c8, c9) from $tb
print $data00
if $data00 != 06070809 then
  return -1
endi

print sql select concat_ws('data' ,c6,c7,c8,c9) from $tb
sql select concat_ws('data' ,c6,c7,c8,c9) from $tb
print $data00

if $data00 != 06data07data08data09 then
  return -1
endi

print sql select length(concat(c2, c3, c4, c5)) from $tb
sql select length(concat(c2, c3, c4, c5)) from $tb
print $data00
if $data00 != 8 then
  return -1
endi

print sql select length(concat_ws('data',c2,c3,c4,c5)) from $tb
sql select length(concat_ws('data',c2,c3,c4,c5)) from $tb
print $data00

if $data00 != 20 then
  return -1
endi
print sql select length(concat(c6, c7, c8, c9)) from $tb
sql select length(concat(c6, c7, c8, c9)) from $tb
print $data00
if $data00 != 32 then
  return -1
endi

print sql select length(concat_ws('data' ,c6,c7,c8,c9)) from $tb
sql select length(concat_ws('data' ,c6,c7,c8,c9)) from $tb
print $data00

if $data00 != 80 then
  return -1
endi

print sql_error select concat(c1, c2, c3, c4, c5) from $tb
sql_error select concat(c1, c2, c3, c4, c5) from $tb
print sql_error select concat_ws('data',c1,c2,c3,c4,c5) from $tb
sql_error select concat_ws('data',c1,c2,c3,c4,c5) from $tb

print ===============> step 3 sql_error stable, group by, window
sql_error select concat(c2) from $stb group by tbname;

sql_error select concat(c2) from $stb group by tgcol;

sql_error select concat(c2) from $stb group by c3;

sql_error select concat(c2) from $stb interval(1m);

sql_error select concat(c2) from $stb state_window(c7);

sql_error select concat(c2) from $tb state_window(c7);

sql_error select concat(c2) from $stb session(ts, 30s);

sql_error select concat(c2) from $tb session(ts, 30s);

sql_error select concat(c2) from $stb slimit 2;

sql_error select concat(c2) from $stb interval(1m) slimit 2;

sql_error select length(c2) from $stb group by tbname;

sql_error select length(c2) from $stb group by tgcol;

sql_error select length(c2) from $stb group by c3;

sql_error select length(c2) from $stb interval(1m);

sql_error select length(c2) from $stb state_window(c7);

sql_error select length(c2) from $tb state_window(c7);

sql_error select length(c2) from $stb session(ts, 30s);

sql_error select length(c2) from $tb session(ts, 30s);

sql_error select length(c2) from $stb slimit 2;

sql_error select length(c2) from $stb interval(1m) slimit 2;

sql_error select concat_ws(c2) from $stb group by tbname;

sql_error select concat_ws(c2) from $stb group by tgcol;

sql_error select concat_ws(c2) from $stb group by c3;

sql_error select concat_ws(c2) from $stb interval(1m);

sql_error select concat_ws(c2) from $stb state_window(c7);

sql_error select concat_ws(c2) from $tb state_window(c7);

sql_error select concat_ws(c2) from $stb session(ts, 30s);

sql_error select concat_ws(c2) from $tb session(ts, 30s);

sql_error select concat_ws(c2) from $stb slimit 2;

sql_error select concat_ws(c2) from $stb interval(1m) slimit 2;
print =============== clear
#sql drop database $db
#sql show databases
#if $rows != 0 then 
#  return -1
#endi

#system sh/exec.sh -n dnode1 -s stop -x SIGINT

